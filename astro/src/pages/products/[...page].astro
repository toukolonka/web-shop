---
import Layout from '../../layouts/Layout.astro';
import ProductList from '../../components/ProductList.jsx'
import PageButtons from '../../components/PageButtons.jsx'

export const prerender = true;

export async function getStaticPaths({ paginate }) {
  const response = await fetch(`http://${import.meta.env.SERVER_HOST_NAME}:8080/api/products/all`);
  const data = await response.json();
  const products = data.sort((p1, p2) => p1.price - p2.price);

  return paginate(products, { pageSize: 50 });
}

const { page } = Astro.props;
---

<Layout>
  <ProductList
    client:only="react"
    products={page.data}
  />
  <PageButtons
    currentPage={page.currentPage}
    prevUrl={page.url.prev}
    nextUrl={page.url.next}
    lastPage={page.lastPage}
  />
</Layout>